
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Defensive Programming &#8212; Data Science for Humans</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Humans</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing_page.html">
                    Welcome to Data Science for Humans
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/00_overview.html">
   Introduction to Data Science for Humans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/10_data_science_in_historical_context.html">
   What
   <em>
    is
   </em>
   Data Science: An Historical Perspective
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/20_our_approach.html">
   About that title…Data Science for Humans?!?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Types of Questions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/00_from_problems_to_questions.html">
   From Problems to Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/10_exploratory_questions.html">
   Exploratory Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/20_passive_prediction_questions.html">
   Classification Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/30_causal_questions.html">
   Causal Questions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Science in Practice
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/00_backwards_design.html">
   Backwards Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/10_ethics.html">
   Ethics in Data Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/20_from_data_to_decisions.html">
   Making Decisions Using Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/25_writing_to_stakeholders.html">
   Writing Data Science Report for Non-Technical Audiences
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Topics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../40_advanced_topics/30_interpretability.html">
   Interpretable Models
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nickeubank/ds4humans/master?urlpath=tree/docs/10_programming/defensive_programming.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/nickeubank/ds4humans"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/nickeubank/ds4humans/issues/new?title=Issue%20on%20page%20%2F10_programming/defensive_programming.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/10_programming/defensive_programming.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#style-matters">
   Style Matters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auto-formatting-code-in-rstudio">
     Auto-Formatting Code in RStudio
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-tests">
   Adding Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-tests">
     Writing Tests
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#when-should-i-write-tests">
   When Should I Write Tests?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-test-examples">
     Common Test Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#don-t-duplicate-information">
   Don’t Duplicate Information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#never-transcribe">
   Never Transcribe
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Defensive Programming</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#style-matters">
   Style Matters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auto-formatting-code-in-rstudio">
     Auto-Formatting Code in RStudio
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-tests">
   Adding Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-tests">
     Writing Tests
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#when-should-i-write-tests">
   When Should I Write Tests?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-test-examples">
     Common Test Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#don-t-duplicate-information">
   Don’t Duplicate Information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#never-transcribe">
   Never Transcribe
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="defensive-programming">
<h1>Defensive Programming<a class="headerlink" href="#defensive-programming" title="Permalink to this headline">#</a></h1>
<p>In recent years, the social sciences have been struggling with a wave of papers that have turned out to have problems not because of problems of theory, or choice of statistical models, but rather because of simple programming errors. In perhaps the most embarassing, Steven Levitt (co-author of the acclaimed Freakonomics, and winner of one of the most prestigious awards in economics) had a paper about the political explosive (at least in the US) topic of abortion and crime that turned out to be wrong <a class="reference external" href="https://www.economist.com/finance-and-economics/2005/12/01/oops-onomics">because he hadn’t put a set of controls into a regression he thought he had (may require sign-in, though I think you can see without paying).</a> Moreover, as some of <a class="reference external" href="https://thepoliticalmethodologist.com/2014/12/09/a-decade-of-replications-lessons-from-the-quarterly-journal-of-political-science/">my own work has shown</a>, the replication packages that come with a substantial number of political science papers have problems, often generating results that do not match those in the published paper.</p>
<p>In reading this, it’s natural to think that the reason we find problems in the code behind published papers is carelessness or inattention on behalf of authors, and that the key to minimizing problems in our code is to be more careful. The truth, I have come to believe, is more subtle: humans are effectively incapable of writing error-free code, and that if we wish to improve the quality of the code we write, we must start learning and teaching coding skills that help maximize the probability our mistakes will be found and corrected.</p>
<p>I myself once firmly believed the fallacy that the key to preventing errors was “to be more careful.” Indeed, I fear this belief may have colored the tone of of my past work on this subject in unproductive ways. Over the last several years, however, my research has brought me into close contact with computer scientists, and I discovered that computer scientists’ mentality about programming is fundamentally different from the mental model I had been carrying around as a social scientist. Computer scientists <em>assume</em> programmers will make mistakes, and instead of chiding people to “just be careful,” they have developed a battery of practices to address the problem. These practices – often referred to as “defensive programming” skills – are designed to (a) minimize the probability mistakes occur and (b) maximize the probability that mistakes that do occur are caught.</p>
<p>In this tutorial, we’ll cover a number of these defensive programming practices with an eye towards their application in the context of applied data science. I did not invent any of these practices, but you will likely find that the way I present them (and the use-cases I emphasize) will differ from most other presentations you will find online. That is because in this tutorial, I will focus on the type of applied data analysis common in the social sciences, natural science, or business analysis, rather than the type of “software engineering” applications where these methods are most commonly applied.</p>
<section id="style-matters">
<h2>Style Matters<a class="headerlink" href="#style-matters" title="Permalink to this headline">#</a></h2>
<p>Formatting isn’t just about aesthetics, they also make code easier to read. This not only helps other people read your code, but it will also help you recognize potential problems in our own code.</p>
<p>Here are a few rules of thumb for good code:</p>
<ul class="simple">
<li><p><strong>Use informative variable names.</strong> Don’t call something <code class="docutils literal notranslate"><span class="pre">var212</span></code> if you can call it <code class="docutils literal notranslate"><span class="pre">unemployment_percentage</span></code>. Informative names require more typing, but they make your code so much easier to read. Moreover, including units in your variables names (<code class="docutils literal notranslate"><span class="pre">percentage</span></code>, <code class="docutils literal notranslate"><span class="pre">km</span></code>, etc.) can also help avoid confusion.</p></li>
<li><p><strong>Comment!</strong> Comments help in two ways. First, and most obviously, they make it easy to figure out what’s going on when you come back to code days, weeks, or months after it was originally written. And second, it forces you to think about what you’re doing in <em>substantive</em> terms (“This section calculates the share of people within each occupation who have college degrees”) rather than just in programming logic, which can help you catch <em>substantive</em> problems with code that may run without problems but will not actually generate the quantity of interest.</p></li>
<li><p><strong>Use indentation.</strong> Indentation is a way of visually representing the logical structure of code – use it to your advantage!</p></li>
<li><p><strong>Let your code breathe.</strong> In general, you should put a space between every operator in your code, and feel free to use empty lines. Space makes your code more readable, as illustrated in the following examples:</p></li>
</ul>
<p>To illustrate, here’s some bad code for saving someone’s income and trying to compute after-tax income:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">&lt;-</span><span class="m">20000</span>
<span class="n">y</span><span class="o">&lt;-</span><span class="n">x</span><span class="o">*</span><span class="m">0.23+1500</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s a much better version of the same code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate impact of taxes on income</span>

<span class="c1"># Start with current income and policies</span>
<span class="n">pre_tax_income</span> <span class="o">&lt;-</span> <span class="m">20000</span>
<span class="n">tax_rate</span> <span class="o">&lt;-</span> <span class="m">0.23</span>
<span class="n">tax_rebate</span> <span class="o">&lt;-</span> <span class="m">1500</span>

<span class="c1"># Calculate final after-tax income</span>
<span class="n">after_tax_income</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">pre_tax_income</span> <span class="o">*</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">tax_rate</span><span class="p">))</span> <span class="o">+</span> <span class="n">tax_rebate</span>
</pre></div>
</div>
</div>
</div>
<p>These two blocks of code do exactly the same thing, but if you wrote them at 1am, guess which one you’d understand better the next morning?</p>
<p>You can find a full guide to R styling <a class="reference external" href="https://style.tidyverse.org/index.html">here</a>, but if you use the tools below you won’t really need to read that to have well styled code.</p>
<section id="auto-formatting-code-in-rstudio">
<h3>Auto-Formatting Code in RStudio<a class="headerlink" href="#auto-formatting-code-in-rstudio" title="Permalink to this headline">#</a></h3>
<p>A really good way to ensure that your code has consistent formatting is to (a) set your editor to check for style problems, and (b) use a program that automatically formats your code. I <strong>love</strong> these tools, and thankfully RStudio has one built in! An auto-formatter won’t help ensure your variable names are descriptive, but it will ensure you use consistent spacing and indentation, which can be really helpful recognizing patterns and problems in your code.</p>
<p>To use this functionality in RStudio, we’ll do two things:</p>
<p><strong>To have RStudio flag style violations:</strong></p>
<p>First open your Global Options by going to the <code class="docutils literal notranslate"><span class="pre">Tools</span></code> menu and selecting <code class="docutils literal notranslate"><span class="pre">Global</span> <span class="pre">Options...</span></code>.</p>
<p>Then, in these preferences, select Code on the left sidebar, then Diagnostics across the top across the window on the right, turn on “Provide R style diagnostics” and click Apply.</p>
<p><img alt="style_checking_setting" src="../_images/style_checking_setting.png" /></p>
<p>Now when you violate a style guideline – like not leave white space around assignment operators, you’ll see a blue squiggly warning, and a <code class="docutils literal notranslate"><span class="pre">i</span></code> button on the left you can mouse over for an explanation:</p>
<p><img alt="style_violations" src="../_images/style_violations.png" /></p>
<p><strong>To have RStudio actively format your code:</strong></p>
<p>First, install the <code class="docutils literal notranslate"><span class="pre">styler</span></code> package in R by running <code class="docutils literal notranslate"><span class="pre">install.packages(&quot;styler&quot;)</span></code> in an active R session.</p>
<p>Then click on the “Add-ons” menu over your editor and select “Style Active File” (note R may ask for permission to install some packages the first time you do this):</p>
<p><img alt="use_r_to_format_code" src="../_images/use_r_to_format_code.png" /></p>
</section>
</section>
<section id="adding-tests">
<h2>Adding Tests<a class="headerlink" href="#adding-tests" title="Permalink to this headline">#</a></h2>
<p>Tests are simple true-false statements users place in their code. A test checks for a certain condition (like whether the sample size in a regression is what you expect), and if the condition is not met, stops your code and alerts you to the problem.</p>
<p><em>Why do I need to always check things? I know my data!</em></p>
<p>In most of the exercises we’ve done in this boot camp, we’ve been using small data sets that are easy to just look at. In the real world of data science and computational social science, however, you will be working with data sets with hundreds of variables and tens of thousands of observation. So you can never really <em>know</em> your data – you only get to see bits and pieces through your analyses, plots, and summary statistics.</p>
<p>I like to think of working with data as being like exploring a dark cave. The documentation for the data is like an old dirty map of the cave system that <em>in theory</em> tells me the layout of the cave, but in reality is often out of date wasn’t drawn very carefully. I can never see the entire cave system, but I can’t turn on my flashlight and check to see if certain features match what I have on the map. If my map matches what I see, great! But sometimes the map won’t match what I see, and those are the situations where I’m really glad that I stop to turn on my flashlight and look around. Tests are a way of automating those types of checks.</p>
<p><em>Yeah, I always check that kind of stuff by hand when I’m writing my code. Why do I need to add tests?</em></p>
<p>The answer is four-fold:</p>
<ol class="simple">
<li><p><strong>Tests are executed <em>every time your code is run</em>.</strong> Most of us check things the first time we write a piece of code. But days, weeks, or months later, we may come back, modify code the occurs earlier in our code stream, and then just re-run the code. If those changes lead to problems in later files, we don’t know about them. If you have tests in place, then those early changes will result in an error in the later files, and you can track down the problem.</p></li>
<li><p><strong>It gets you in the habit of always checking.</strong> Most of us only stop to check aspects of our data when we suspect problems. But if you become accustomed to writing a handful of tests at the bottom of every file – or after ever execution of a certain operation (I’m trying to always including them after a merge), we get into the habit of <em>always</em> stopping to think about what our data should look like.</p></li>
<li><p><strong>Catch your problems faster.</strong> This is less about code integrity than sanity, but a great upside to tests is that they ensure that if a mistake slips into your code, you become aware of it quickly, making it easier to identify and fix the changes that caused the problem.</p></li>
<li><p><strong>Tests catch more than anticipated problems.</strong> When problems emerge in code, they often manifest in lots of different ways. Duplicate observations, for example, will not only lead to inaccurate observation counts, but may also give rise to bizarre summary statistics, bad subsequent merges, etc. Thus adding tests not only guards against errors we’ve thought of, but may also guard against errors we don’t anticipate during the test writing process.</p></li>
</ol>
<p>OK, but is this really necessary? <strong>YES.</strong></p>
<section id="writing-tests">
<h3>Writing Tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">#</a></h3>
<p>In R, I recommend using the <code class="docutils literal notranslate"><span class="pre">assertthat</span></code> package for testing. Once installed, you just use <code class="docutils literal notranslate"><span class="pre">assert_that()</span></code> to test any logical statement:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="m">7</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="m">5</span>

<span class="c1"># Make sure that x is greater than y</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">TRUE</div></div>
</div>
<p>If the assertion is TRUE, the code continuous along happily. If it is <em>not</em> true, however, you get something like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ERROR</span><span class="o">:</span> <span class="n">Error</span><span class="o">:</span> <span class="n">x</span> <span class="n">not</span> <span class="n">less</span> <span class="n">than</span> <span class="n">y</span>
<span class="o">&gt;</span> <span class="n">Error</span><span class="o">:</span> <span class="n">x</span> <span class="n">not</span> <span class="n">less</span> <span class="n">than</span> <span class="n">y</span>
<span class="o">&gt;</span> <span class="n">Traceback</span><span class="o">:</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="m">1</span><span class="n">.</span> <span class="nf">assert_that</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assert_that</span></code> can also be used to test properties of vectors, though doing so requires one additional step.</p>
<p>Since logical tests applied to vectors return vectors, we have to specify how to evaluate that whole vector using <code class="docutils literal notranslate"><span class="pre">any()</span></code> (returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if any entries in the vector are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>) or <code class="docutils literal notranslate"><span class="pre">all()</span></code> (only returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if <em>all</em> the entries are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>). For example, if I don’t use these helpers, I get:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

<span class="nf">assert_that</span><span class="p">(</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ERROR</span><span class="o">:</span> <span class="n">Error</span><span class="o">:</span> <span class="n">assert_that</span><span class="o">:</span> <span class="n">length</span> <span class="n">of</span> <span class="n">assertion</span> <span class="n">is</span> <span class="n">not</span> <span class="m">1</span>
<span class="o">&gt;</span> <span class="n">Error</span><span class="o">:</span> <span class="n">assert_that</span><span class="o">:</span> <span class="n">length</span> <span class="n">of</span> <span class="n">assertion</span> <span class="n">is</span> <span class="n">not</span> <span class="m">1</span>
<span class="o">&gt;</span> <span class="n">Traceback</span><span class="o">:</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="m">1</span><span class="n">.</span> <span class="nf">assert_that</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="m">2</span><span class="n">.</span> <span class="nf">see_if</span><span class="p">(</span><span class="kc">...</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="n">env</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="m">3</span><span class="n">.</span> <span class="nf">check_result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="m">4</span><span class="n">.</span> <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;assert_that: length of assertion is not 1&quot;</span><span class="p">,</span> <span class="n">call.</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
<p>So instead if I want to know if ALL entries of <code class="docutils literal notranslate"><span class="pre">x</span></code> are less than their matching entries in <code class="docutils literal notranslate"><span class="pre">y</span></code>, I can run:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

<span class="nf">assert_that</span><span class="p">(</span><span class="nf">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>And I’ll be told:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">ERROR</span><span class="o">:</span> <span class="n">Error</span><span class="o">:</span> <span class="n">Elements</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="n">of</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="n">are</span> <span class="n">not</span> <span class="n">true</span>
<span class="o">&gt;</span> <span class="n">Error</span><span class="o">:</span> <span class="n">Elements</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="n">of</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="n">are</span> <span class="n">not</span> <span class="n">true</span>
<span class="o">&gt;</span> <span class="n">Traceback</span><span class="o">:</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="m">1</span><span class="n">.</span> <span class="nf">assert_that</span><span class="p">(</span><span class="nf">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>My contrast, if I only wanted to be sure that SOME of the entries of <code class="docutils literal notranslate"><span class="pre">x</span></code> were less than <code class="docutils literal notranslate"><span class="pre">y</span></code>, I could do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">Error</span>: No elements of x &lt; y are true
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">assert_that</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>And we’d be good!</p>
<p><strong>WARNING:</strong> Tests and Interactive Programming in R</p>
<p>One really important thing to know about: if you run an R file using the source command, an error will stop R in its tracks. But if you’re highlighting a block of code and sending it to R by typing “Command-Return”  (with the standard R GUI text-editor or in RStudio) or clicking the Run button in RStudio, R will throw an error then keep going!</p>
<p>There is a weird work around available, but if you don’t want to use it, you need to either (a) watch your output, or (b) make sure to run your code using the source(file.R)command or by clicking the Source button in RStudio instead of the Run button.</p>
<p>To see, try the following code:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="s">&#39;test&#39;</span>
<span class="nf">assert_that</span><span class="p">(</span> <span class="nf">is.numeric</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
<span class="nf">print</span><span class="p">(</span> <span class="s">&#39;hello world&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>If you run this interactively, you’ll see a red error message, but the print statement will still run. If you save this file and execute it with the source command / Source button, the print statement will never be run.</p>
</section>
</section>
<section id="when-should-i-write-tests">
<h2>When Should I Write Tests?<a class="headerlink" href="#when-should-i-write-tests" title="Permalink to this headline">#</a></h2>
<p>The best way to get into writing tests is to think about how you check your data interactively to make stuff work. After a <code class="docutils literal notranslate"><span class="pre">merge</span></code> or another complicated command, most people pause to browse the data and/or watch the code step by step, or do a set of quick tabs or plots.  But these are not systematic, and you generally only do them once (when you’re first writing the code).</p>
<p>A great way to write tests is to think about what you’re looking for when you do these interactive tests and convert the logic of those interactive interrogations into systematic assert statements. That way they’ll be baked into your code, and will be executed every time your code runs!1</p>
<ul class="simple">
<li><p>After merging data: No where are problems with data made more clear than in a merge. ALWAYS add tests after a merge! We’ll talk more about this in our reading on merging.</p></li>
<li><p>After complicated manipulations: If you have to think more than a little about how to get R to do something, there’s a chance you missed something. Add a test or two to make sure you did it right!</p></li>
<li><p>Before dropping observations: Dropping observations masks problems. Before you drop variables, add a test to, say, count the number of observations you expect to drop.</p></li>
</ul>
<section id="common-test-examples">
<h3>Common Test Examples<a class="headerlink" href="#common-test-examples" title="Permalink to this headline">#</a></h3>
<p>Test number of observations is right:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll use `countries` again:</span>

<span class="n">country</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;USA&quot;</span><span class="p">,</span> <span class="s">&quot;China&quot;</span><span class="p">,</span> <span class="s">&quot;Sudan&quot;</span><span class="p">),</span> <span class="m">3</span><span class="p">)</span>
<span class="n">year</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1994</span><span class="p">,</span> <span class="m">1994</span><span class="p">,</span> <span class="m">1994</span><span class="p">,</span> <span class="m">1995</span><span class="p">,</span> <span class="m">1995</span><span class="p">,</span> <span class="m">1995</span><span class="p">,</span> <span class="m">1996</span><span class="p">,</span> <span class="m">1996</span><span class="p">,</span> <span class="m">1996</span><span class="p">)</span>
<span class="n">gdp_pc</span> <span class="o">&lt;-</span> <span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="m">1000</span><span class="p">,</span> <span class="m">20000</span><span class="p">))</span>

<span class="n">countries</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">gdp_pc</span><span class="p">)</span>
<span class="n">countries</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 9 × 3</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>gdp_pc</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>USA  </td><td>1994</td><td>16775</td></tr>
	<tr><td>China</td><td>1994</td><td>13351</td></tr>
	<tr><td>Sudan</td><td>1994</td><td> 9909</td></tr>
	<tr><td>USA  </td><td>1995</td><td>11195</td></tr>
	<tr><td>China</td><td>1995</td><td> 3323</td></tr>
	<tr><td>Sudan</td><td>1995</td><td>15216</td></tr>
	<tr><td>USA  </td><td>1996</td><td> 6113</td></tr>
	<tr><td>China</td><td>1996</td><td> 2576</td></tr>
	<tr><td>Sudan</td><td>1996</td><td>11927</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">==</span> <span class="m">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">TRUE</div></div>
</div>
<p>Check var that should have no missing has no missing.</p>
<p>Make sure values of GDP Per Capita have a reasonable value. Note this is a “reasonableness” test, not an absolute test. It’s possible this would fail and the data is ok, but this way if there’s a problem your attention will be flagged so you can check.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">all</span><span class="p">((</span><span class="m">1000</span> <span class="o">&lt;</span> <span class="n">countries</span><span class="o">$</span><span class="n">gdp_pc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">countries</span><span class="o">$</span><span class="n">gdp_pc</span> <span class="o">&lt;</span> <span class="m">100000</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">TRUE</div></div>
</div>
</section>
</section>
<section id="don-t-duplicate-information">
<h2>Don’t Duplicate Information<a class="headerlink" href="#don-t-duplicate-information" title="Permalink to this headline">#</a></h2>
<p>Tricks to minimize the probability of errors often require a little more sophisticated programming, so they won’t be for everyone (tests, I feel, are more accessible to everyone). Nevertheless, here’s another valuable practice: <strong>Never replicate information.</strong></p>
<p>Information should only be expressed once in a file. For example, say you want to drop observations from a dataset if a person’s income has ever dropped below 20,000. You <em>could</em> do this like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">income_2019</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">10000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">50000</span><span class="p">),</span>
                   <span class="n">income_2018</span><span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">50000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">10000</span><span class="p">),</span>
                   <span class="n">income_2017</span><span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">50000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">50000</span><span class="p">))</span>
                   
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2019&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">20000</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2018&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">20000</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2017&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">20000</span><span class="p">),]</span>
                   
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 2 × 3</caption>
<thead>
	<tr><th></th><th scope=col>income_2019</th><th scope=col>income_2018</th><th scope=col>income_2017</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>10000</td><td>50000</td><td>50000</td></tr>
	<tr><th scope=row>5</th><td>50000</td><td>10000</td><td>50000</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>And indeed, this would work. But suppose you decided to change that cutoff from 20,000 to 30,000. The way this is written, you’ve opened yourself up to the possibility that in trying to change these cutoffs, you may change two of these but forget the third (something especially likely if the uses of the cutoff aren’t all in exactly the same place in your code). A better way of expressing this that avoids this possibility is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">income_2019</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">10000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">50000</span><span class="p">),</span>
                 <span class="n">income_2018</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">50000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">10000</span><span class="p">),</span>
                 <span class="n">income_2017</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">50000</span><span class="p">,</span> <span class="m">20000</span><span class="p">,</span> <span class="m">30000</span><span class="p">,</span> <span class="m">40000</span><span class="p">,</span> <span class="m">50000</span><span class="p">))</span>

<span class="n">income_threshold</span> <span class="o">&lt;-</span> <span class="m">20000</span>

<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2019&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">income_threshold</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2018&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">income_threshold</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="s">&quot;income_2017&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">income_threshold</span><span class="p">),</span> <span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 2 × 3</caption>
<thead>
	<tr><th></th><th scope=col>income_2019</th><th scope=col>income_2018</th><th scope=col>income_2017</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>10000</td><td>50000</td><td>50000</td></tr>
	<tr><th scope=row>5</th><td>50000</td><td>10000</td><td>50000</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Written like this, if you ever decide to go back and change the common cutoff, you only have to make <em>in one place</em>, and there’s no way to make the change in some cases but forget others.</p>
</section>
<section id="never-transcribe">
<h2>Never Transcribe<a class="headerlink" href="#never-transcribe" title="Permalink to this headline">#</a></h2>
<p>We’ve already covered tricks to maximize the probability we catch our mistakes, but how do we minimize the probability they will occur? If there is anything I learned working as the Replication Assistant at the <em>Quarterly Journal of Political Science</em> testing people’s replication packages, it is that authors should <strong>never</strong> transcribe numbers from their statistical software into their papers by hand. This was <em>easily</em> the largest source of replication issues we encountered, as doing so introduced two types of errors:</p>
<ul class="simple">
<li><p><strong>Mis-transcriptions:</strong> Humans just aren’t built to transcribe dozens of numbers by hand reliably. If the error is in the last decimal place, it doesn’t mean much, but when a decimal point drifts or a negative sign is dropped, the results are often quite substantively important.</p></li>
<li><p><strong>Failures to Update:</strong> We are constantly updating our code, and authors who hand transcribe their results often update their code and forget to update all of their results, leaving old results in their paper.</p></li>
</ul>
<p>So, how do you avoid this problem? Use tools that will directly export your results into plain text or formatted tables you can use in the program where you are working, like <a class="reference external" href="https://www.rdocumentation.org/packages/stargazer/versions/5.2.2/topics/stargazer">stargazer</a> in R.</p>
<p>I also suggest users not only do this for tables - which is increasingly common - but also statistics that appear in text. For example, to put a single number into <span class="math notranslate nohighlight">\(\LaTeX\)</span>, you just generate the number you want to put in your paper, convert it to a string, and save it to disk as a <code class="docutils literal notranslate"><span class="pre">.tex</span></code> file (e.g. <code class="docutils literal notranslate"><span class="pre">exported_statistic.tex</span></code>). Then in your paper, simply add a <code class="docutils literal notranslate"><span class="pre">\input{exported_statistic.tex}</span></code>call, and LaTeX will insert the contents of that <code class="docutils literal notranslate"><span class="pre">.tex</span></code> file verbatim into your paper.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./10_programming"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Josh Clinton and Nick Eubank<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>