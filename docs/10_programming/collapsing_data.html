
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Collapsing Data &#8212; Data Science for Humans</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Humans</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing_page.html">
                    Welcome to Data Science for Humans
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/00_overview.html">
   Introduction to Data Science for Humans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/10_data_science_in_historical_context.html">
   What
   <em>
    is
   </em>
   Data Science: An Historical Perspective
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_introduction/20_our_approach.html">
   About that title…Data Science for Humans?!?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Types of Questions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/00_from_problems_to_questions.html">
   From Problems to Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/10_exploratory_questions.html">
   Exploratory Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/20_passive_prediction_questions.html">
   Classification Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20_questions/30_causal_questions.html">
   Causal Questions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Science in Practice
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/00_backwards_design.html">
   Backwards Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/10_ethics.html">
   Ethics in Data Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/20_from_data_to_decisions.html">
   Making Decisions Using Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../30_in_practice/25_writing_to_stakeholders.html">
   Writing Data Science Report for Non-Technical Audiences
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Topics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../40_advanced_topics/30_interpretability.html">
   Interpretable Models
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nickeubank/ds4humans/master?urlpath=tree/docs/10_programming/collapsing_data.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/nickeubank/ds4humans"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/nickeubank/ds4humans/issues/new?title=Issue%20on%20page%20%2F10_programming/collapsing_data.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/10_programming/collapsing_data.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-grouping-variable">
   One grouping variable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#several-grouping-variables">
   Several grouping variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-manipulation">
   Additional manipulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#different-functions">
   Different functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Collapsing Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-grouping-variable">
   One grouping variable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#several-grouping-variables">
   Several grouping variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-manipulation">
   Additional manipulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#different-functions">
   Different functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="collapsing-data">
<h1>Collapsing Data<a class="headerlink" href="#collapsing-data" title="Permalink to this headline">#</a></h1>
<p><strong>PRELIMINARY SITE DRAFT. MUCH WORK TO BE DONE!</strong></p>
<p>This tutorial explains how to collapse data in R. Collapsing means using one or several <em>grouping variables</em> to find summary statistics — mean, median, etc. — for different categories in your data. For example, if you have yearly income data for the 50 U.S. states over a 10-year period (i.e., you have 500 data points), you may want to know what the mean income was in each state (collapsing the data to 50 data points) or in each year (10 data points). Or you may want to collapse the data by year <em>and</em> U.S. region, say, South v. non-South (20 data points). Like the <span class="xref myst">tutorial on modifying data</span> this tutorial draws on a set of intuitive and elegant functions from the <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> package.</p>
<p>Before we begin, let’s load the <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> package. We’ll make particular
use of two functions from this package: <code class="docutils literal notranslate"><span class="pre">group_by</span></code> and
<code class="docutils literal notranslate"><span class="pre">summarize</span></code>. We’ll also make use of chaining, which you can read more
about in the tutorial on
<a class="reference external" href="../modifying-data/#chaining">modifying data</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">require</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: dplyr
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“replacing previous import ‘lifecycle::last_warnings’ by ‘rlang::last_warnings’ when loading ‘tibble’”
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attaching package: ‘dplyr’
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following objects are masked from ‘package:stats’:

    filter, lag
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union
</pre></div>
</div>
</div>
</div>
<section id="one-grouping-variable">
<h2>One grouping variable<a class="headerlink" href="#one-grouping-variable" title="Permalink to this headline">#</a></h2>
<p>To illustrate how collapsing works, let’s create a data frame with
three variables: <code class="docutils literal notranslate"><span class="pre">student</span></code> (an id variable that uniquely
identifies each row); <code class="docutils literal notranslate"><span class="pre">school</span></code> (a grouping variable indicating the
student’s school); and <code class="docutils literal notranslate"><span class="pre">sat_score</span></code> (the student’s SAT score).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
    <span class="n">student</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;al&quot;</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">,</span> <span class="s">&quot;cindy&quot;</span><span class="p">,</span> <span class="s">&quot;dan&quot;</span><span class="p">,</span> <span class="s">&quot;ella&quot;</span><span class="p">,</span> <span class="s">&quot;frank&quot;</span><span class="p">,</span> <span class="s">&quot;gina&quot;</span><span class="p">,</span> <span class="s">&quot;henry&quot;</span><span class="p">),</span> 
    <span class="n">school</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;stanford&quot;</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="nf">rep</span><span class="p">(</span><span class="s">&quot;berkley&quot;</span><span class="p">,</span> <span class="m">4</span><span class="p">)),</span>
    <span class="n">sat_score</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">750</span><span class="p">,</span> <span class="m">730</span><span class="p">,</span> <span class="m">690</span><span class="p">,</span> <span class="m">800</span><span class="p">,</span> <span class="m">780</span><span class="p">,</span> <span class="m">720</span><span class="p">,</span> <span class="m">730</span><span class="p">,</span> <span class="m">700</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Which school — Stanford or Berkley — attracts students with
a higher SAT score? Based on my (in reality-not-so-random) random
assignment of scores, it appears to be Stanford:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>mean(sat_score)</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>732.5</td></tr>
	<tr><td>stanford</td><td>742.5</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>In words, the mean SAT score for Berkley students is 732.5, and the mean
for Stanford students is 742.5. (<code class="docutils literal notranslate"><span class="pre">dplyr</span></code> also outputs some information about
the new data frame for us, such as its dimensions and the class of each
of its variables.)</p>
<p>To be clear, here’s how <code class="docutils literal notranslate"><span class="pre">group_by()</span></code> and <code class="docutils literal notranslate"><span class="pre">summarize()</span></code> work. First,
<code class="docutils literal notranslate"><span class="pre">group_by()</span></code> specifies the grouping variable, i.e., the variable that
classifies observations into different clusters. In this case, we’re
classifying students by the school they attend. Second, <code class="docutils literal notranslate"><span class="pre">summarize()</span></code>
specifies what to do with the data points within each cluster.  In
this case, we’re finding the mean SAT score in each cluster.</p>
<p>It’s often useful to assign a name to the collapsed variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">mean_sat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>mean_sat</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>732.5</td></tr>
	<tr><td>stanford</td><td>742.5</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Also note that you’d often want to save the resulting collapsed
data frame to R’s memory. Here’s how to do this, creating a new
object called <code class="docutils literal notranslate"><span class="pre">grades_clps</span></code> with the collapsed data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades_clps</span> <span class="o">&lt;-</span> <span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">mean_sat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
<span class="n">grades_clps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>mean_sat</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>732.5</td></tr>
	<tr><td>stanford</td><td>742.5</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="several-grouping-variables">
<h2>Several grouping variables<a class="headerlink" href="#several-grouping-variables" title="Permalink to this headline">#</a></h2>
<p>In the previous example we collapsed the data using only one grouping
variable. Collapsing can also be done using several grouping
variables. Let’s modify the <code class="docutils literal notranslate"><span class="pre">grades</span></code> data frame to illustrate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
    <span class="n">student</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;al&quot;</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">,</span> <span class="s">&quot;cindy&quot;</span><span class="p">,</span> <span class="s">&quot;dan&quot;</span><span class="p">,</span> <span class="s">&quot;ella&quot;</span><span class="p">,</span> <span class="s">&quot;frank&quot;</span><span class="p">,</span> <span class="s">&quot;gina&quot;</span><span class="p">,</span> <span class="s">&quot;henry&quot;</span><span class="p">),</span> 
    <span class="n">school</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;stanford&quot;</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="nf">rep</span><span class="p">(</span><span class="s">&quot;berkley&quot;</span><span class="p">,</span> <span class="m">4</span><span class="p">)),</span>
    <span class="n">classof</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2017</span><span class="p">,</span> <span class="m">2017</span><span class="p">,</span> <span class="m">2018</span><span class="p">,</span> <span class="m">2018</span><span class="p">),</span> <span class="m">2</span><span class="p">),</span> 
    <span class="n">sat_score</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">750</span><span class="p">,</span> <span class="m">730</span><span class="p">,</span> <span class="m">690</span><span class="p">,</span> <span class="m">800</span><span class="p">,</span> <span class="m">780</span><span class="p">,</span> <span class="m">720</span><span class="p">,</span> <span class="m">730</span><span class="p">,</span> <span class="m">700</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">grades</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 8 × 4</caption>
<thead>
	<tr><th scope=col>student</th><th scope=col>school</th><th scope=col>classof</th><th scope=col>sat_score</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>al   </td><td>stanford</td><td>2017</td><td>750</td></tr>
	<tr><td>bo   </td><td>stanford</td><td>2017</td><td>730</td></tr>
	<tr><td>cindy</td><td>stanford</td><td>2018</td><td>690</td></tr>
	<tr><td>dan  </td><td>stanford</td><td>2018</td><td>800</td></tr>
	<tr><td>ella </td><td>berkley </td><td>2017</td><td>780</td></tr>
	<tr><td>frank</td><td>berkley </td><td>2017</td><td>720</td></tr>
	<tr><td>gina </td><td>berkley </td><td>2018</td><td>730</td></tr>
	<tr><td>henry</td><td>berkley </td><td>2018</td><td>700</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We now have two grouping variables: <code class="docutils literal notranslate"><span class="pre">school</span></code> and <code class="docutils literal notranslate"><span class="pre">classof</span></code>. The latter specifies
the expected graduation year for each student.</p>
<p>Collapsing by these two grouping variables follows the same logic as above. Just
specify the variables to collapse by inside <code class="docutils literal notranslate"><span class="pre">group_by()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">,</span> <span class="n">classof</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">mean_sat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;school&#39;. You can override using the `.groups` argument.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A grouped_df: 4 × 3</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>classof</th><th scope=col>mean_sat</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>2017</td><td>750</td></tr>
	<tr><td>berkley </td><td>2018</td><td>715</td></tr>
	<tr><td>stanford</td><td>2017</td><td>740</td></tr>
	<tr><td>stanford</td><td>2018</td><td>745</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="additional-manipulation">
<h2>Additional manipulation<a class="headerlink" href="#additional-manipulation" title="Permalink to this headline">#</a></h2>
<p>One nice thing about using <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> functions for collapsing data is
that you can combine them with other data manipulation functions, many
of which are covered in a separate tutorial on
<span class="xref myst">modifying data</span>. The result is elegant code that
is easy to debug and relatively quick to execute. Here’s an example in
which I’m filtering the <code class="docutils literal notranslate"><span class="pre">grades</span></code> data frame to class of 2017 and then
collapsing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">classof</span> <span class="o">==</span> <span class="m">2017</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">mean_sat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>mean_sat</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>750</td></tr>
	<tr><td>stanford</td><td>740</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Here’s an example that adds a variable after the collapse (rescaling
the mean SAT scores to be between 0 and 100, assuming 800 is the maximum
possible score):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">mean_sat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">mean_sat_strd</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_sat</span> <span class="o">/</span> <span class="m">800</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 3</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>mean_sat</th><th scope=col>mean_sat_strd</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>732.5</td><td>91.5625</td></tr>
	<tr><td>stanford</td><td>742.5</td><td>92.8125</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="different-functions">
<h2>Different functions<a class="headerlink" href="#different-functions" title="Permalink to this headline">#</a></h2>
<p>In all the examples above I’ve used <code class="docutils literal notranslate"><span class="pre">mean()</span></code> inside <code class="docutils literal notranslate"><span class="pre">summarize()</span></code>. Of
course you’re by no means limited to finding the mean. You can use all of
R’s built-in functions or write your own function. Here are examples that
make use of other common functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">median_sat</span> <span class="o">=</span> <span class="nf">median</span><span class="p">(</span><span class="n">sat_score</span><span class="p">),</span>
              <span class="n">sd_sat</span> <span class="o">=</span> <span class="nf">sd</span><span class="p">(</span><span class="n">sat_score</span><span class="p">),</span> 
              <span class="n">min_sat</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">sat_score</span><span class="p">),</span>
              <span class="n">max_sat</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">sat_score</span><span class="p">),</span>
              <span class="n">dif_maxmin</span> <span class="o">=</span> <span class="n">max_sat</span> <span class="o">-</span> <span class="n">min_sat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 6</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>median_sat</th><th scope=col>sd_sat</th><th scope=col>min_sat</th><th scope=col>max_sat</th><th scope=col>dif_maxmin</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>725</td><td>34.03430</td><td>700</td><td>780</td><td> 80</td></tr>
	<tr><td>stanford</td><td>740</td><td>45.73474</td><td>690</td><td>800</td><td>110</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Here’s an example of using your own function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">maxmindif</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">dif_maxmin</span> <span class="o">=</span> <span class="nf">maxmindif</span><span class="p">(</span><span class="n">sat_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>dif_maxmin</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td> 80</td></tr>
	<tr><td>stanford</td><td>110</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Lastly, <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> provides a few special functions that can be used
within <code class="docutils literal notranslate"><span class="pre">summarize()</span></code>. One very useful special function is <code class="docutils literal notranslate"><span class="pre">n()</span></code>, which
provides the number of observations in each cluster:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">school</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">no_obs</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>school</th><th scope=col>no_obs</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>berkley </td><td>4</td></tr>
	<tr><td>stanford</td><td>4</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Read the <code class="docutils literal notranslate"><span class="pre">world-small.csv</span></code> dataset (available
<span class="xref myst">here</span>) into R. Get to know the structure of
this dataset using functions like <code class="docutils literal notranslate"><span class="pre">dim()</span></code>, <code class="docutils literal notranslate"><span class="pre">head()</span></code>, and <code class="docutils literal notranslate"><span class="pre">summary()</span></code>.</p></li>
<li><p>Find the mean and median GDP per capita and Polity IV score, by
region (that is, for each region in the dataset). Also find the number
of countries by region.</p></li>
<li><p>Find the mean and median GDP per capita, by region and whether a country
is a “democracy” or not. For the purpose of this exercise, a country is a
“democracy” if it has a Polity IV score of 15 or higher.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./10_programming"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Josh Clinton and Nick Eubank<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>